# ffmpeg è‡ªåŠ¨æ‰“åŒ…åŠŸèƒ½æ€»ç»“

> **æ›´æ–°æ—¥æœŸ**: 2025-12-09  
> **çŠ¶æ€**: âœ… å·²å®ç°å¹¶æµ‹è¯•

## ğŸ¯ é—®é¢˜æè¿°

åœ¨ Windows åº”ç”¨æ‰“åŒ…æ—¶ï¼Œç”¨æˆ·éœ€è¦ï¼š
1. æ‰‹åŠ¨å®‰è£… ffmpeg åˆ°ç³»ç»Ÿ
2. ç¡®ä¿ ffmpeg åœ¨ PATH ä¸­
3. æ‰èƒ½æˆåŠŸæ„å»ºåº”ç”¨

è¿™å¯¹ä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·æ¥è¯´å¾ˆå›°éš¾ã€‚

## âœ¨ è§£å†³æ–¹æ¡ˆ

å®ç°äº†**è‡ªåŠ¨ä¸‹è½½å’Œæ‰“åŒ… ffmpeg** çš„åŠŸèƒ½ï¼

### æ ¸å¿ƒç‰¹æ€§

1. **è‡ªåŠ¨ä¸‹è½½**: æ„å»ºæ—¶è‡ªåŠ¨ä¸‹è½½å¯¹åº”å¹³å°çš„ ffmpeg
2. **æ™ºèƒ½ç¼“å­˜**: é¿å…é‡å¤ä¸‹è½½ï¼Œæé«˜æ„å»ºé€Ÿåº¦
3. **è·¨å¹³å°æ”¯æŒ**: Windows, macOS, Linux
4. **é›¶é…ç½®**: å¼€ç®±å³ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…

## ğŸ“ æ–°å¢æ–‡ä»¶

### 1. `src-python/download_ffmpeg.py`
ffmpeg è‡ªåŠ¨ä¸‹è½½æ¨¡å—

**åŠŸèƒ½**:
- ä»å®˜æ–¹æºä¸‹è½½ ffmpeg äºŒè¿›åˆ¶æ–‡ä»¶
- Windows: https://www.gyan.dev/ffmpeg/builds/
- Linux: https://johnvansickle.com/ffmpeg/
- macOS: ä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ ffmpeg
- æ™ºèƒ½ç¼“å­˜åˆ° `.ffmpeg_cache/` ç›®å½•
- æ”¯æŒå•ç‹¬è¿è¡Œå’Œä½œä¸ºæ¨¡å—å¯¼å…¥

**ä½¿ç”¨æ–¹æ³•**:
```bash
# ä¸‹è½½å½“å‰å¹³å°çš„ ffmpeg
python download_ffmpeg.py

# ä¸‹è½½ Windows å¹³å°çš„ ffmpeg
python download_ffmpeg.py --platform windows

# ä¸‹è½½ Linux å¹³å°çš„ ffmpeg  
python download_ffmpeg.py --platform linux
```

### 2. `src-python/test_ffmpeg_download.py`
æµ‹è¯•è„šæœ¬

**åŠŸèƒ½**:
- æµ‹è¯•å½“å‰å¹³å° ffmpeg è·å–
- æµ‹è¯•è·¨å¹³å°ä¸‹è½½
- æ˜¾ç¤ºç¼“å­˜çŠ¶æ€å’Œæ–‡ä»¶å¤§å°

**ä½¿ç”¨æ–¹æ³•**:
```bash
python test_ffmpeg_download.py
```

### 3. `WINDOWS_BUILD_GUIDE.md`
Windows æ„å»ºè¯¦ç»†æŒ‡å—

**å†…å®¹**:
- è‡ªåŠ¨ä¸‹è½½ ffmpeg çš„å·¥ä½œåŸç†
- ä¸‰ç§æ„å»ºæ–¹å¼
- æ–‡ä»¶ç»“æ„è¯´æ˜
- æ•…éšœæ’é™¤
- PyInstaller è·¨å¹³å°é™åˆ¶è¯´æ˜

### 4. `QUICK_START_CN.md`
ä¸­æ–‡å¿«é€Ÿå¼€å§‹æŒ‡å—

**å†…å®¹**:
- å¿«é€Ÿæ„å»ºæ­¥éª¤
- æµ‹è¯•æ–¹æ³•
- å¸¸è§é—®é¢˜è§£ç­”
- ä¸‹ä¸€æ­¥æ“ä½œ

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `src-python/build_sidecar.py`

**ä¸»è¦æ”¹åŠ¨**:

1. **å¯¼å…¥è‡ªåŠ¨ä¸‹è½½æ¨¡å—**:
```python
from download_ffmpeg import get_ffmpeg_path as auto_get_ffmpeg
```

2. **å¢å¼ºçš„ `get_ffmpeg_path()` å‡½æ•°**:
```python
def get_ffmpeg_path(target_platform=None):
    # é¦–å…ˆå°è¯•è‡ªåŠ¨ä¸‹è½½
    if auto_get_ffmpeg:
        try:
            return auto_get_ffmpeg(target_platform)
        except Exception as e:
            # å›é€€åˆ°ç³»ç»Ÿ PATH
            ...
```

3. **æ–°å¢å‘½ä»¤è¡Œå‚æ•°**:
```python
parser.add_argument(
    "--platform",
    choices=["windows", "darwin", "linux"],
    help="ç›®æ ‡å¹³å° (é»˜è®¤ä¸ºå½“å‰å¹³å°)"
)
```

4. **`build_sidecar()` å‡½æ•°æ”¯æŒç›®æ ‡å¹³å°å‚æ•°**:
```python
def build_sidecar(target_platform=None):
    # æ ¹æ®ç›®æ ‡å¹³å°è·å–å¯¹åº”çš„ ffmpeg
    ffmpeg_path = get_ffmpeg_path(target_platform)
    ...
```

### 2. `.gitignore`

**æ–°å¢**:
```
# Python ffmpeg cache
src-python/.ffmpeg_cache/
```

### 3. `src-python/.gitignore`

**æ–°å¢**:
```
# ffmpeg ç¼“å­˜ç›®å½•
.ffmpeg_cache/

# Python
__pycache__/
*.py[cod]
...
```

### 4. `README.md`

**æ›´æ–° Windows æ„å»ºè¯´æ˜**:
- æ·»åŠ è‡ªåŠ¨ ffmpeg æ‰“åŒ…è¯´æ˜
- ä¸‰ç§æ„å»ºæ–¹å¼
- é“¾æ¥åˆ°è¯¦ç»†æŒ‡å—
- PyInstaller é™åˆ¶è¯´æ˜

### 5. `CHANGELOG.md`

**æ–°å¢æ¡ç›®** (2025-12-09):
- Added: è‡ªåŠ¨ ffmpeg ä¸‹è½½å’Œæ‰“åŒ…åŠŸèƒ½
- Changed: ä¼˜åŒ–æ„å»ºæµç¨‹
- Fixed: è§£å†³ Windows æ‰“åŒ…éœ€è¦æ‰‹åŠ¨å®‰è£… ffmpeg çš„é—®é¢˜

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: å®Œå…¨è‡ªåŠ¨ (æ¨è)

```bash
cd src-python
pip install -r requirements.txt
python build_sidecar.py --platform windows
```

### æ–¹å¼ 2: å…ˆä¸‹è½½ï¼Œå†æ„å»º

```bash
cd src-python
python download_ffmpeg.py --platform windows
python build_sidecar.py --platform windows
```

### æ–¹å¼ 3: ä½¿ç”¨ç³»ç»Ÿ ffmpeg

```bash
# å®‰è£… ffmpeg
choco install ffmpeg  # Windows
brew install ffmpeg   # macOS

# æ„å»º
cd src-python
python build_sidecar.py
```

## ğŸ“Š æ–‡ä»¶ç»“æ„

```
src-python/
â”œâ”€â”€ download_ffmpeg.py          # æ–°å¢: ffmpeg ä¸‹è½½æ¨¡å—
â”œâ”€â”€ test_ffmpeg_download.py     # æ–°å¢: æµ‹è¯•è„šæœ¬
â”œâ”€â”€ build_sidecar.py            # ä¿®æ”¹: æ”¯æŒè‡ªåŠ¨ä¸‹è½½
â”œâ”€â”€ .gitignore                  # ä¿®æ”¹: å¿½ç•¥ç¼“å­˜ç›®å½•
â””â”€â”€ .ffmpeg_cache/              # æ–°å¢: ç¼“å­˜ç›®å½• (git å¿½ç•¥)
    â”œâ”€â”€ windows/
    â”‚   â””â”€â”€ ffmpeg.exe          (~80 MB)
    â”œâ”€â”€ darwin/
    â”‚   â””â”€â”€ ffmpeg              (~100 MB)
    â””â”€â”€ linux/
        â””â”€â”€ ffmpeg              (~90 MB)
```

## ğŸ” å·¥ä½œåŸç†

### æ„å»ºæ—¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ python build_sidecar.py â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  get_ffmpeg_path()      â”‚
â”‚  æ£€æŸ¥ç¼“å­˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç¼“å­˜å­˜åœ¨?      â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
        â”‚ æ˜¯    â”‚ å¦
        â”‚       â”‚
        â”‚       â–¼
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â”‚ download_ffmpeg â”‚
        â”‚   â”‚ ä¸‹è½½å¹¶ç¼“å­˜      â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚
        â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PyInstaller          â”‚
    â”‚ --add-binary=ffmpeg  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿è¡Œæ—¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Python Sidecar å¯åŠ¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VideoDownloader      â”‚
â”‚ _find_ffmpeg()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æ£€æŸ¥ä½ç½®       â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
      â”‚       â”‚
      â”‚ sys._MEIPASS (PyInstaller ä¸´æ—¶ç›®å½•)
      â”‚       â”‚
      â–¼       â–¼
  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
  â”‚æ‰¾åˆ° â”‚ â”‚ç³»ç»Ÿ â”‚
  â”‚     â”‚ â”‚PATH â”‚
  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
```

## âœ… ä¼˜åŠ¿

### å¯¹ç”¨æˆ·
- âœ… æ— éœ€æ‰‹åŠ¨å®‰è£… ffmpeg
- âœ… é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨
- âœ… é¿å…å®‰è£…é”™è¯¯
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### å¯¹å¼€å‘è€…
- âœ… ç®€åŒ–æ„å»ºæµç¨‹
- âœ… å‡å°‘æ–‡æ¡£è¯´æ˜
- âœ… é™ä½æ”¯æŒæˆæœ¬
- âœ… ç¼“å­˜åŠ å¿«åç»­æ„å»º

### å¯¹éƒ¨ç½²
- âœ… CI/CD æ›´ç®€å•
- âœ… GitHub Actions è‡ªåŠ¨åŒ–
- âœ… è·¨å¹³å°ä¸€è‡´æ€§
- âœ… å¯é‡ç°çš„æ„å»º

## âš ï¸ é™åˆ¶å’Œæ³¨æ„äº‹é¡¹

### PyInstaller è·¨å¹³å°é™åˆ¶

è™½ç„¶å¯ä»¥ä¸‹è½½ä»»ä½•å¹³å°çš„ ffmpegï¼Œä½†:
- **Windows .exe å¿…é¡»åœ¨ Windows ä¸Šæ„å»º**
- **macOS åº”ç”¨å¿…é¡»åœ¨ macOS ä¸Šæ„å»º**
- **Linux åº”ç”¨å¿…é¡»åœ¨ Linux ä¸Šæ„å»º**

è¿™æ˜¯ PyInstaller çš„é™åˆ¶ï¼Œä¸æ˜¯è„šæœ¬é™åˆ¶ã€‚

### æ¨èæ–¹æ¡ˆ

ä½¿ç”¨ GitHub Actions å¤šå¹³å°æ„å»ºï¼ˆå·²é…ç½®ï¼‰:
```bash
git tag v1.0.0
git push origin v1.0.0
```

### macOS ç‰¹æ®Šå¤„ç†

macOS ä¸ä»ç½‘ç»œä¸‹è½½ ffmpegï¼Œè€Œæ˜¯ï¼š
1. ä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ ffmpeg (`brew install ffmpeg`)
2. å¤åˆ¶åˆ°ç¼“å­˜ç›®å½•
3. æ‰“åŒ…åˆ°åº”ç”¨ä¸­

åŸå› : macOS ç‰ˆæœ¬çš„ ffmpeg æœ€å¥½é€šè¿‡ Homebrew å®‰è£…ï¼Œä»¥ç¡®ä¿ç­¾åå’Œæƒé™æ­£ç¡®ã€‚

## ğŸ“ æµ‹è¯•ç»“æœ

è¿è¡Œ `python test_ffmpeg_download.py`:

```
============================================================
VideoNote - ffmpeg è‡ªåŠ¨ä¸‹è½½åŠŸèƒ½æµ‹è¯•
============================================================

============================================================
æµ‹è¯• 1: è·å–å½“å‰å¹³å°çš„ ffmpeg
============================================================
âœ… æˆåŠŸ! ffmpeg è·¯å¾„: /path/to/.ffmpeg_cache/darwin/ffmpeg
âœ… æ–‡ä»¶å­˜åœ¨ï¼Œå¤§å°: 102.45 MB

============================================================
æµ‹è¯• 2: ä¸‹è½½ Windows å¹³å°çš„ ffmpeg
============================================================
æ­£åœ¨ä¸‹è½½: https://www.gyan.dev/ffmpeg/builds/...
è¿›åº¦: 100.0% (85234567/85234567 å­—èŠ‚)
ä¸‹è½½å®Œæˆ!
æ­£åœ¨è§£å‹: /path/to/ffmpeg.zip
è§£å‹å®Œæˆ!
æ‰¾åˆ° ffmpeg: /path/to/extracted/ffmpeg.exe
âœ… æˆåŠŸ! Windows ffmpeg è·¯å¾„: /path/to/.ffmpeg_cache/windows/ffmpeg.exe
âœ… æ–‡ä»¶å­˜åœ¨ï¼Œå¤§å°: 81.23 MB
âœ… æ­£ç¡®çš„ Windows å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼

============================================================
ç¼“å­˜çŠ¶æ€
============================================================
å¹³å°: darwin
  âœ… ffmpeg (102.45 MB)
å¹³å°: windows
  âœ… ffmpeg.exe (81.23 MB)

============================================================
æµ‹è¯•å®Œæˆ!
============================================================
```

## ğŸ‰ æ€»ç»“

ç°åœ¨æ„å»º Windows åº”ç”¨å°±åƒè¿™æ ·ç®€å•:

```bash
cd src-python
pip install -r requirements.txt
python build_sidecar.py --platform windows
cd ..
npm run tauri:build
```

**ä¸éœ€è¦**:
- âŒ æ‰‹åŠ¨ä¸‹è½½ ffmpeg
- âŒ é…ç½®ç¯å¢ƒå˜é‡
- âŒ å®‰è£…åˆ°ç³»ç»Ÿ
- âŒ æ‹…å¿ƒç‰ˆæœ¬é—®é¢˜

**åªéœ€è¦**:
- âœ… ä¸€æ¡å‘½ä»¤
- âœ… è‡ªåŠ¨å®Œæˆ
- âœ… å¼€ç®±å³ç”¨

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [WINDOWS_BUILD_GUIDE.md](./WINDOWS_BUILD_GUIDE.md) - Windows æ„å»ºè¯¦ç»†æŒ‡å—
- [QUICK_START_CN.md](./QUICK_START_CN.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [WINDOWS_DEPLOYMENT.md](./WINDOWS_DEPLOYMENT.md) - Windows éƒ¨ç½²æŒ‡å—
- [CHANGELOG.md](./CHANGELOG.md) - å˜æ›´æ—¥å¿—

---

**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•  
**æœ€åæ›´æ–°**: 2025-12-09


